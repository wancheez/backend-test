Что сделано:

1. Изменил структуру проекта. Разделил код по логическим модулям.
2. Избавился от прямой зависимости от Postgres. Теперь queries зависят от абстрактного DataSource. Реализация конкретного DataSource лежит в data_sources.
3. Поправил миграции, чтобы запускались корректно. 
4. Реализовал требуемую ручку.
5. Написал тесты для data_source. 